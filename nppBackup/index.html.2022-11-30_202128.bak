<!DOCTYPE html>
<html>
	<style>
		html, body {
		  margin: 5px;
		  height: 99%;
		  width: 99%;
		}

		object { 
		  height: 99%;
		  width: 99%;
		}
	</style>
	<meta name="viewport" content="width=device-width, initial-scale=1.00, maximum-scale=2.00, minimum-scale=1.00">
	<body bgcolor="#212148">
		<object data="calendar.svg" type="image/svg+xml" id="calendar_obj" width="100%" height="100%" style="margin: auto"></object>
		<script>
			var svgElements = {};
			var openedWindows = {};
			
			window.onload = function() {
				svgElements.calendarContent = document.getElementById("calendar_obj").contentDocument;
				svgElements.openedWindow = svgElements.calendarContent.querySelector('[id="Opened_Window"]');
				svgElements.windowsSvgRoot = svgElements.calendarContent.querySelector('[id="All_Windows"]');
				
				svgElements.windows = svgElements.calendarContent.querySelectorAll('[id^="Window"]');
				svgElements.windows.forEach(function(currentValue, currentIndex, listObj) {
					currentValue.addEventListener("click", OnWindowClicked, false);
					currentValue.addEventListener("mouseenter", OnWindowEnter, false);
					currentValue.addEventListener("mouseleave", OnWindowLeave, false);
					
				});
			}
			
			function OnWindowEnter(e) {
				var light = e.currentTarget.getElementsByClassName("st25");
				light[0].classList.replace("st25", "stLightsOn");
			}
			
			function OnWindowLeave(e) {
				var light = e.currentTarget.getElementsByClassName("stLightsOn");
				light[0].classList.replace("stLightsOn", "st25");
			}
			
			function OnWindowClicked(e){
				OpenWindow(e.currentTarget);
			}
			
			function OpenWindow(wnd) {
				var openedCloneId = "Opened_" + wnd.id;
				if (svgElements.windowsSvgRoot.querySelector("[id=" + openedCloneId + "]"))
					return;
					
				var openedClone = svgElements.openedWindow.cloneNode(true);
				openedClone.id = openedCloneId;
				
				svgElements.windowsSvgRoot.appendChild(openedClone);
				openedClone.classList.remove("st0");
				
				var clickedCenter = GetElementCenter(wnd);
				var openedCenter = GetElementCenter(openedClone);
				
				var deltaX = clickedCenter.x - openedCenter.x;
				var deltaY = clickedCenter.y - openedCenter.y;
				
				var transformValue = "translate(" + deltaX + "," + deltaY + ")";
				openedClone.setAttribute('transform', transformValue);
			}
			
			function GetElementCenter(el) {
				var bbox = el.getBBox();
				var pt = {
					x : bbox.x + bbox.width / 2,
					y : bbox.y + bbox.height / 2
				};
				
				return pt;
			}
			
			function StoreOpenedWindow(wnd) {
				openedWindows.push(wnd.id);
				
				alert(document.cookie);
				document.cookie += " " + openedCloneId + ";max-age="+(3600*24);
					
			}
			
		</script>
	</body>
</html>